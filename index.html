<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PB VelocityBoard</title>

  <style>
    :root{
      --bg1:#07162f;
      --bg2:#041022;

      --text:#0f1526;
      --muted:rgba(15,21,38,.62);
      --muted2:rgba(15,21,38,.46);

      --line:rgba(15,21,38,.10);
      --lineSoft:rgba(15,21,38,.06);

      --accent:#2f6bff;
      --accent2:#2bb7ff;

      --danger:#e23b57;
      --ok:#18a965;

      --radius: 22px;
      --shadow: 0 18px 60px rgba(0,0,0,.16);
      --shadow2: 0 10px 26px rgba(0,0,0,.12);

      --w: 1180px;
      --gap: 14px;
      --appbarH: 84px;

      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    html[data-theme="light"]{
      --bg1:#eef4ff;
      --bg2:#f6fbff;
      --text:#0f1526;
      --muted:rgba(15,21,38,.62);
      --muted2:rgba(15,21,38,.46);
      --line:rgba(15,21,38,.10);
      --lineSoft:rgba(15,21,38,.06);
    }
    html[data-theme="dark"]{
      --bg1:#07162f;
      --bg2:#041022;
      --text:#0f1526;
      --muted:rgba(15,21,38,.62);
      --muted2:rgba(15,21,38,.46);
      --line:rgba(255,255,255,.14);
      --lineSoft:rgba(255,255,255,.08);
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: var(--font);
      color: var(--text);
      background:
        radial-gradient(1200px 800px at 12% 8%, rgba(47,107,255,.18), transparent 60%),
        radial-gradient(1000px 700px at 86% 18%, rgba(43,183,255,.12), transparent 58%),
        radial-gradient(900px 650px at 38% 92%, rgba(11,42,111,.26), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }
    button, input, select{ font-family:inherit; }

    .wrap{
      max-width: var(--w);
      margin: 0 auto;
      padding: calc(var(--appbarH) + 18px) 18px 26px;
    }

    /* ------------------------------
      Appbar (more premium)
    ------------------------------ */
    .appbar{
      position:fixed;
      top:0; left:0; right:0;
      z-index:50;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      background: rgba(255,255,255,.78);
      border-bottom:1px solid rgba(15,21,38,.10);
    }
    html[data-theme="light"] .appbar{ background: rgba(255,255,255,.86); }

    .appbarInner{
      max-width: var(--w);
      margin:0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 12px 18px;
      flex-wrap: wrap;
    }

    .brand{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 210px;
      flex: 1 1 auto;
    }

    .avatar{
      width: 42px; height: 42px;
      border-radius: 16px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.30), transparent 55%),
        linear-gradient(135deg, rgba(47,107,255,.14), rgba(43,183,255,.14));
      border: 1px solid rgba(15,21,38,.10);
      box-shadow: 0 14px 30px rgba(47,107,255,.10);
      flex: 0 0 auto;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      cursor:pointer;
      user-select:none;
    }
    .avatar img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .avatar .emoji{
      font-size: 20px;
      font-weight: 900;
      line-height: 1;
      opacity:.9;
    }

    .brandText{
      display:flex;
      flex-direction:column;
      line-height:1.15;
      min-width: 160px;
    }
    .brandText strong{
      font-size: 18px;
      letter-spacing:.2px;
      font-weight: 950;
    }
    .brandText span{
      font-size: 12.5px;
      color: var(--muted);
      font-weight: 800;
    }

    .tabs{
      display:flex;
      gap: 8px;
      padding: 6px;
      border:1px solid rgba(15,21,38,.12);
      border-radius: 999px;
      background: rgba(255,255,255,.68);
      flex: 0 0 auto;
      overflow-x:auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      align-items:center;
    }
    .tabs::-webkit-scrollbar{ display:none; }

    .tabBtn{
      border:0;
      padding: 9px 14px;
      border-radius: 999px;
      background: transparent;
      color: rgba(15,21,38,.62);
      font-weight:850;
      letter-spacing:.2px;
      cursor:pointer;
      transition: .18s ease;
      white-space: nowrap;
      flex: 0 0 auto;
    }
    .tabBtn:hover{ color: var(--text); background: rgba(15,21,38,.05); }
    .tabBtn.active{
      color: var(--text);
      background: rgba(47,107,255,.10);
      border: 1px solid rgba(47,107,255,.18);
    }

    .giftBtn{
      border:1px solid rgba(15,21,38,.12);
      background: rgba(255,255,255,.80);
      width: 38px;
      height: 38px;
      border-radius: 999px;
      cursor:pointer;
      font-size: 18px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      transition: .18s ease;
      flex: 0 0 auto;
    }
    .giftBtn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.95); }

    .rightTools{
      display:flex;
      align-items:center;
      gap: 8px;
      justify-content:flex-end;
      flex-wrap: wrap;
      flex: 1 1 520px;
    }

    .selectWrap{ position:relative; flex: 1 1 220px; min-width: 220px; }
    .selectWrap:after{
      content:"‚ñæ";
      position:absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-52%);
      color: var(--muted);
      pointer-events:none;
      font-size: 12px;
    }

    .select{
      width:100%;
      appearance:none;
      -webkit-appearance:none;
      border:1px solid rgba(15,21,38,.12);
      background: rgba(255,255,255,.92);
      color: var(--text);
      padding: 10px 34px 10px 12px;
      border-radius: 14px;
      font-weight:900;
      outline:none;
      cursor:pointer;
    }
    select, option{ color: var(--text); background-color: #ffffff; }

    /* Buttons: more classy, consistent */
    .btn{
      border:1px solid rgba(15,21,38,.12);
      background: rgba(255,255,255,.86);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight:900;
      cursor:pointer;
      transition: .18s ease;
      display:inline-flex;
      align-items:center;
      gap: 8px;
      white-space:nowrap;
      box-shadow: none;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.96); }
    .btn:active{ transform: translateY(0px); }
    .btnPrimary{
      border: none;
      background: linear-gradient(135deg, rgba(47,107,255,.98), rgba(43,183,255,.92));
      color: white;
      box-shadow: 0 14px 34px rgba(47,107,255,.16);
    }
    .btnDanger{
      border: 1px solid rgba(226,59,87,.22);
      background: rgba(226,59,87,.10);
    }

    /* Glass panels: calmer + premium */
    .card{
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.66), rgba(255,255,255,.50));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }

    .cardHeader{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap: 12px;
      margin-bottom: 10px;
    }
    .title{ font-size: 18px; font-weight: 950; letter-spacing:.2px; }
    .sub{ color: var(--muted); font-size: 13px; margin-top: 3px; line-height:1.35; }

    .divider{
      height: 1px;
      background: var(--lineSoft);
      margin: 12px 0;
      border-radius: 99px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 7px 10px;
      border-radius: 999px;
      border:1px solid rgba(15,21,38,.12);
      background: rgba(15,21,38,.035);
      color: rgba(15,21,38,.70);
      font-size: 12px;
      font-weight:900;
      white-space:nowrap;
    }

    .field{ display:flex; flex-direction:column; gap: 6px; }
    .field label{ font-size: 12px; font-weight: 900; color: var(--muted); letter-spacing:.2px; }
    .input, .select2{
      border:1px solid rgba(15,21,38,.12);
      background: rgba(255,255,255,.92);
      color: var(--text);
      border-radius: 14px;
      padding: 10px 12px;
      outline:none;
      font-weight: 900;
    }
    .input:focus, .select:focus, .select2:focus{
      outline:none;
      border-color: rgba(47,107,255,.32);
      box-shadow: 0 0 0 4px rgba(47,107,255,.10);
    }

    /* Table: cleaner + more enterprise */
    .table{
      width:100%;
      border-collapse: collapse;
      margin-top: 10px;
      overflow:hidden;
      border-radius: 16px;
      border:1px solid rgba(15,21,38,.10);
      background: rgba(255,255,255,.84);
    }
    .table th, .table td{
      padding: 11px 10px;
      font-size: 13px;
      border-bottom:1px solid rgba(15,21,38,.06);
      text-align:left;
      vertical-align:top;
      color: var(--text);
    }
    .table th{
      color: rgba(15,21,38,.68);
      font-weight: 950;
      font-size: 12px;
      letter-spacing:.34px;
      background: linear-gradient(180deg, rgba(15,21,38,.035), rgba(15,21,38,.02));
    }
    .table tr:hover td{
      background: rgba(47,107,255,.03);
      cursor:pointer;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      font-weight: 950;
      border:1px solid rgba(15,21,38,.10);
      background: rgba(15,21,38,.035);
      white-space:nowrap;
      color: rgba(15,21,38,.80);
    }
    .badgeOK{ border-color: rgba(24,169,101,.22); background: rgba(24,169,101,.09); }
    .badgePB{ border-color: rgba(200,139,0,.22); background: rgba(200,139,0,.10); }

    .iconBtn{
      border:1px solid rgba(15,21,38,.10);
      background: rgba(15,21,38,.04);
      color: var(--text);
      width: 34px;
      height: 34px;
      border-radius: 12px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      transition:.18s ease;
    }
    .iconBtn:hover{ transform: translateY(-1px); background: rgba(15,21,38,.06); }
    .iconBtnDanger{ background: rgba(226,59,87,.10); border: 1px solid rgba(226,59,87,.22); }

    .chart{
      width:100%;
      height: 260px;
      border-radius: 16px;
      border:1px solid rgba(15,21,38,.10);
      background: rgba(255,255,255,.82);
      overflow:hidden;
      margin-top: 12px;
      position:relative;
    }
    .chart canvas{ width:100%; height:100%; display:block; }
    .chartHint{
      position:absolute;
      left: 50%;
      transform: translateX(-50%);
      top: 10px;
      font-size: 13px;
      color: rgba(15,21,38,.70);
      font-weight: 950;
      letter-spacing:.2px;
      text-align:center;
      white-space:nowrap;
      pointer-events:none;
    }

    .empty{
      border:1px dashed rgba(15,21,38,.18);
      border-radius: 18px;
      padding: 18px;
      color: var(--muted);
      background: rgba(255,255,255,.58);
      margin-top: 10px;
    }
    .empty strong{ color: var(--text); font-weight: 950; }
    .empty p{ margin: 8px 0 0; font-size: 13px; line-height:1.5; }

    .banner{
      display:none;
      margin: 0 0 14px;
      border-radius: 18px;
      padding: 12px 14px;
      border: 1px solid rgba(47,107,255,.18);
      background: rgba(255,255,255,.74);
      box-shadow: 0 18px 50px rgba(0,0,0,.10);
      color: var(--text);
    }
    .banner.show{ display:block; }
    .banner strong{ font-weight: 950; }
    .banner .small{ color: var(--muted); font-size: 12px; margin-top: 3px; }

    /* Cards strip */
    .handWrap{
      margin-top: 10px;
      padding: 6px 2px 12px;
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      scroll-snap-type: x mandatory;
      display:flex;
      gap: 12px;
      align-items: stretch;
      flex-wrap: nowrap;
      width: 100%;
    }
    .handWrap::-webkit-scrollbar{ display:none; }

    .distCard{
      flex: 0 0 clamp(300px, 86vw, 380px);
      scroll-snap-align: start;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.68), rgba(255,255,255,.50));
      box-shadow: var(--shadow2);
      padding: 12px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      position:relative;
      overflow:hidden;
      min-width: 300px;
    }

    .distTop{ display:flex; align-items:flex-start; justify-content:space-between; gap: 10px; }
    .distTitle{ display:flex; flex-direction:column; gap: 4px; min-width: 0; }
    .distTitle .big{
      font-weight: 950;
      font-size: 16px;
      line-height: 1.1;
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    .distTitle .small{
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 240px;
    }
    .distStats{ display:flex; flex-direction:column; align-items:flex-end; gap: 4px; flex: 0 0 auto; }
    .distStats .pb{
      font-weight: 950;
      font-size: 13px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(47,107,255,.08);
      border: 1px solid rgba(47,107,255,.16);
      white-space:nowrap;
    }
    .distStats .count{ font-size: 12px; color: var(--muted); font-weight: 950; white-space:nowrap; }

    .distList{
      border-radius: 14px;
      border: 1px solid rgba(15,21,38,.10);
      background: rgba(255,255,255,.80);
      padding: 8px;
      overflow-y: auto;
      max-height: 320px;
      -webkit-overflow-scrolling: touch;
    }

    .entryItem{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 8px;
      padding: 10px;
      border-radius: 14px;
      border: 1px solid rgba(15,21,38,.08);
      background: rgba(255,255,255,.88);
      margin-bottom: 8px;
    }
    .entryItem:last-child{ margin-bottom: 0; }

    .entryMain{ display:flex; flex-direction:column; gap: 4px; min-width: 0; }
    .entryMain .line1{ display:flex; gap: 8px; align-items:center; flex-wrap:wrap; }
    .entryMain .time{
      font-weight: 950;
      font-size: 14px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15,21,38,.035);
      border: 1px solid rgba(15,21,38,.08);
      white-space:nowrap;
    }
    .entryMain .meta{
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 240px;
    }
    .entryMain .notes{
      font-size: 12px;
      color: var(--muted2);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 280px;
    }

    .entryActions{
      display:flex;
      flex-direction:column;
      gap: 8px;
      align-items:flex-end;
      justify-content:flex-start;
    }

    .screen{ display:none; }
    .screen.active{ display:block; }

    .modalOverlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.45);
      display:none;
      z-index: 100;
      align-items:center;
      justify-content:center;
      padding: 20px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }
    .modalOverlay.show{ display:flex; }
    .modal{
      width: min(720px, 100%);
      max-height: calc(100vh - 70px);
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      border-radius: 20px;
      border: 1px solid rgba(15,21,38,.12);
      background: rgba(255,255,255,.92);
      box-shadow: var(--shadow);
      padding: 16px;
      position: relative;
      z-index: 2;
    }
    .modalTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      margin-bottom: 12px;
      position: sticky;
      top: 0;
      background: rgba(255,255,255,.92);
      padding-bottom: 10px;
      z-index: 3;
    }
    .modalTop h3{ margin:0; font-size: 16px; font-weight: 950; color: var(--text); }
    .modalTop p{ margin:4px 0 0; color: var(--muted); font-size: 13px; line-height:1.4; }
    .xbtn{
      border: 1px solid rgba(15,21,38,.10);
      background: rgba(15,21,38,.04);
      color: var(--text);
      border-radius: 12px;
      width: 38px; height: 38px;
      cursor:pointer;
      font-weight: 950;
      flex: 0 0 auto;
    }

    .error{
      display:none;
      color: #7d1424;
      background: rgba(226,59,87,.12);
      border: 1px solid rgba(226,59,87,.25);
      border-radius: 14px;
      padding: 10px 12px;
      font-size: 12px;
      font-weight: 950;
      margin-top: 10px;
    }
    .error.show{ display:block; }

    .modalActions{
      display:flex;
      gap: 10px;
      justify-content:flex-end;
      margin-top: 12px;
      flex-wrap:wrap;
      position: sticky;
      bottom: 0;
      background: rgba(255,255,255,.92);
      padding-top: 10px;
      z-index: 3;
    }

    .entryRows{ display:flex; flex-direction:column; gap: 10px; margin-top: 8px; }
    .entryRow{
      display:grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 10px;
      align-items:end;
      border: 1px solid rgba(15,21,38,.10);
      background: rgba(255,255,255,.84);
      border-radius: 16px;
      padding: 10px;
    }
    .miniBtn{
      border:1px solid rgba(15,21,38,.12);
      background: rgba(255,255,255,.88);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 950;
      cursor:pointer;
      transition:.18s ease;
      white-space:nowrap;
    }
    .miniBtn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.96); }
    .miniBtnDanger{ border:1px solid rgba(226,59,87,.22); background: rgba(226,59,87,.10); }

    .foot{ margin-top: 14px; color: var(--muted2); font-size: 12px; line-height:1.5; }

    @media (min-width: 980px){
      .appbarInner{ flex-wrap: nowrap; padding: 10px 18px; }
      .rightTools{ flex-wrap: nowrap; }
      .tabs{ padding: 4px; gap: 6px; }
      .tabBtn{ padding: 8px 12px; font-size: 13px; }
      .btn{ padding: 9px 11px; border-radius: 13px; }
      .select{ padding: 9px 34px 9px 12px; border-radius: 13px; }
    }

    @media (max-width: 560px){
      .brandText span{ display:none; }
      .rightTools{
        display:grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        width: 100%;
        justify-content:flex-start;
      }
      .selectWrap{ grid-column: 1 / -1; min-width: 100%; }
      .btn{ width: 100%; justify-content:center; }
      .entryRow{ grid-template-columns: 1fr; }
      .modal{ max-height: calc(100vh - 40px); }
      .chartHint{ white-space:normal; width: 90%; text-align:center; }
      .distList{ max-height: 52vh; }
    }
  </style>
</head>

<body>
  <div class="appbar">
    <div class="appbarInner">
      <div class="brand">
        <div class="avatar" id="avatarBtn" title="Click to set athlete avatar"></div>
        <div class="brandText">
          <strong>PB VelocityBoard</strong>
          <span>Track ‚Ä¢ Improve ‚Ä¢ Celebrate</span>
        </div>
      </div>

      <div class="tabs" role="tablist" aria-label="PB VelocityBoard Tabs">
        <button class="tabBtn active" data-tab="home">Home</button>
        <button class="tabBtn" data-tab="analytics">Analytics</button>
        <button class="tabBtn" data-tab="export">Export</button>
        <button class="tabBtn" data-tab="settings">Settings</button>
        <button class="giftBtn" id="btnDonate" title="Donate / Support">üéÅ</button>
      </div>

      <div class="rightTools">
        <div class="selectWrap">
          <select id="athleteSelect" class="select" title="Select Athlete"></select>
        </div>
        <button class="btn" id="btnEditAthlete">Edit</button>
        <button class="btn btnPrimary" id="btnAddAthlete">+ Add Athlete</button>
        <button class="btn" id="btnAddEntry">+ Add Race</button>
        <button class="btn btnDanger" id="btnReset">Reset</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div id="pbBanner" class="banner">
      <strong>üéâ New PB!</strong>
      <div class="small" id="pbBannerText">Saved.</div>
    </div>

    <section id="screenHome" class="screen active">
      <div class="card">
        <!-- PB Summary -->
        <div class="cardHeader" style="margin-bottom:6px;">
          <div>
            <div class="title">PB Summary</div>
            <div class="sub">Best time for each distance (click any PB row to edit).</div>
          </div>
          <div class="pill" id="pillAthlete">No athlete selected</div>
        </div>

        <div class="cardHeader" style="margin-top:10px;">
          <div class="pill" id="pillPBCount">0 PBs</div>
          <div class="pill" id="pillCount">0 races</div>
        </div>

        <div id="pbSummaryWrap"></div>

        <div class="divider"></div>

        <!-- ‚úÖ Race Cards + Distance Focus moved here -->
        <div class="cardHeader" style="align-items:flex-end;">
          <div>
            <div class="title" style="font-size:16px;">Race Cards (by distance)</div>
            <div class="sub">Swipe/scroll left/right like a card deck. Each card scrolls up/down for entries.</div>
          </div>

          <div style="min-width: 240px;">
            <div class="field" style="margin:0;">
              <label style="margin:0;">Distance Focus (for cards)</label>
              <select id="distanceFilter" class="select2"></select>
            </div>
          </div>
        </div>

        <div id="cardsWrap" class="handWrap"></div>

        <div class="foot">Tip: Everything is saved on this device (local storage).</div>
      </div>
    </section>

    <section id="screenAnalytics" class="screen">
      <div class="card">
        <div class="cardHeader">
          <div>
            <div class="title">Performance Snapshot</div>
            <div class="sub">Trend (Time vs Race Date) for the selected athlete and distance focus.</div>
          </div>
          <div class="pill" id="pillAnalytics">‚Äî</div>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px;" class="formGrid">
          <div class="field">
            <label>Distance Focus (for chart)</label>
            <select id="analyticsDistance" class="select2"></select>
            <div class="help" id="anCount" style="margin-top:6px; color:var(--muted); font-weight:950;">‚Äî</div>
          </div>

          <div class="field">
            <label>PB (Selected Distance)</label>
            <div class="input" style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
              <div style="font-weight:950;" id="anPB">‚Äî</div>
              <div style="font-size:12px; color:var(--muted); font-weight:950;" id="anPBMeta">Select a distance to display PB</div>
            </div>
          </div>
        </div>

        <div class="chart">
          <div class="chartHint">Trend (Time vs Race Date)</div>
          <canvas id="trendCanvas" width="1200" height="420"></canvas>
        </div>
      </div>
    </section>

    <section id="screenExport" class="screen">
      <div class="card">
        <div class="cardHeader">
          <div>
            <div class="title">CSV Import / Template</div>
            <div class="sub">Download the template, fill it, and upload to import into the selected athlete.</div>
          </div>
          <div class="pill" id="pillExport">‚Äî</div>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <button class="btn" id="btnExportCSV">Download CSV (selected athlete)</button>
          <button class="btn" id="btnDownloadTemplate">‚¨áÔ∏è Download CSV Template</button>
        </div>

        <div class="empty" style="margin-top:12px;">
          <strong>Upload CSV</strong>
          <p>Data from this file will be added to the currently selected athlete.</p>
          <div class="field" style="margin-top:10px;">
            <label>Choose CSV file</label>
            <input class="input" id="csvFile" type="file" accept=".csv" />
          </div>
          <div style="margin-top:10px;">
            <button class="btn btnPrimary" id="btnImportCSV">Import into selected athlete</button>
          </div>
          <div id="importMsg" class="error"></div>
        </div>
      </div>
    </section>

    <section id="screenSettings" class="screen">
      <div class="card">
        <div class="cardHeader">
          <div>
            <div class="title">Settings</div>
            <div class="sub">Preferences.</div>
          </div>
          <div class="pill">Local Storage</div>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px;" class="formGrid">
          <div class="field">
            <label>Theme</label>
            <select id="themeSelect" class="select2">
              <option value="dark">Dark</option>
              <option value="light">Light</option>
            </select>
          </div>

          <div class="field">
            <label>Time placeholder</label>
            <input id="timeHint" class="input" value="00:52.300" />
          </div>
        </div>

        <div class="empty" style="margin-top:12px;">
          <strong>Storage note</strong>
          <p>All data is stored on this device. To start fresh: Reset.</p>
        </div>
      </div>
    </section>
  </div>

  <!-- MODALS (same as your previous version) -->
  <!-- For brevity: keep the EXACT modals + script from your last working build -->
  <!-- ‚úÖ IMPORTANT: only change below in SCRIPT: distance options now set AFTER moving UI -->

  <script>
    const PAYPAL_ME = "https://paypal.me/MandeepSardarni";

    const LS_KEY  = "pb_velocityboard_v11";
    const LS_PREF = "pb_velocityboard_prefs_v11";

    const defaultState = { athletes: [], activeAthleteId: null };
    const defaultPrefs = { defaultDistance: "ALL", timeHint: "00:52.300", theme: "dark" };

    let state = loadState();
    let prefs = loadPrefs();

    const tabBtns = [...document.querySelectorAll(".tabBtn")];
    const screens = {
      home: document.getElementById("screenHome"),
      analytics: document.getElementById("screenAnalytics"),
      export: document.getElementById("screenExport"),
      settings: document.getElementById("screenSettings")
    };

    const athleteSelect = document.getElementById("athleteSelect");
    const distanceFilter    = document.getElementById("distanceFilter");
    const analyticsDistance = document.getElementById("analyticsDistance");

    const pbBanner = document.getElementById("pbBanner");
    const pbBannerText = document.getElementById("pbBannerText");

    const pillAthlete = document.getElementById("pillAthlete");
    const pillCount = document.getElementById("pillCount");
    const pillPBCount = document.getElementById("pillPBCount");
    const pbSummaryWrap = document.getElementById("pbSummaryWrap");
    const cardsWrap = document.getElementById("cardsWrap");

    const pillAnalytics = document.getElementById("pillAnalytics");
    const anPB = document.getElementById("anPB");
    const anPBMeta = document.getElementById("anPBMeta");
    const anCount = document.getElementById("anCount");

    const pillExport = document.getElementById("pillExport");
    const csvFile = document.getElementById("csvFile");
    const importMsg = document.getElementById("importMsg");

    const timeHint = document.getElementById("timeHint");
    const themeSelect = document.getElementById("themeSelect");

    const avatarBtn = document.getElementById("avatarBtn");

    const canvas = document.getElementById("trendCanvas");
    const ctx = canvas.getContext("2d");

    // NOTE: Your previous build includes many modals + event handlers.
    // Keep that full script from your last working version here.
    // Only add/ensure this init part remains so Distance Focus options render properly.

    function init(){
      if(!state.athletes) state = structuredClone(defaultState);
      if(!prefs) prefs = structuredClone(defaultPrefs);

      applyTheme();

      const distOptionsHtml = `
        <option value="ALL">All distances</option>
        <option value="111m">111m</option>
        <option value="222m">222m</option>
        <option value="333m">333m</option>
        <option value="400m">400m</option>
        <option value="500m">500m</option>
        <option value="800m">800m</option>
        <option value="1000m">1000m</option>
        <option value="1500m">1500m</option>
      `;
      distanceFilter.innerHTML = distOptionsHtml;
      analyticsDistance.innerHTML = distOptionsHtml;

      distanceFilter.value = prefs.defaultDistance || "ALL";
      analyticsDistance.value = prefs.defaultDistance || "ALL";

      timeHint.value = prefs.timeHint || "00:52.300";
      themeSelect.value = prefs.theme || "dark";

      renderAll(true);
      syncAppbarHeight();
    }

    function applyTheme(){
      const t = prefs.theme || "dark";
      document.documentElement.setAttribute("data-theme", t);
      syncAppbarHeight();
    }

    function syncAppbarHeight(){
      const appbar = document.querySelector(".appbar");
      if(!appbar) return;
      const h = appbar.offsetHeight || 84;
      document.documentElement.style.setProperty("--appbarH", h + "px");
    }

    function loadState(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        return raw ? JSON.parse(raw) : structuredClone(defaultState);
      }catch(e){
        return structuredClone(defaultState);
      }
    }
    function saveState(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }
    function loadPrefs(){
      try{
        const raw = localStorage.getItem(LS_PREF);
        return raw ? JSON.parse(raw) : structuredClone(defaultPrefs);
      }catch(e){
        return structuredClone(defaultPrefs);
      }
    }
    function savePrefs(){ localStorage.setItem(LS_PREF, JSON.stringify(prefs)); }

    /* ---------------------------------------------------------
      ‚úÖ IMPORTANT:
      Paste your FULL working script from your last version here
      (all functions + handlers: modals, add/edit/delete entry,
       time parsing, charts, CSV, donate, etc.)
      Keep init() call at the end.
    --------------------------------------------------------- */

    // TEMP placeholders to prevent errors if you paste later:
    function renderAll(){ /* paste your full version */ }

    window.addEventListener("resize", syncAppbarHeight);
    init();
  </script>
</body>
</html>
